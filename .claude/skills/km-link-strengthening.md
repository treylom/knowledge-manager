# Knowledge Manager 연결 강화 스킬

> 새로 생성된 노트와 기존 vault 노트 간 자동 양방향 링크 생성

---

## 스킬 개요

이 스킬은 노트 생성 후 자동으로 실행되어:
1. 새 노트의 핵심 개념 추출
2. Vault 전체에서 관련 노트 탐색
3. 새 노트에 관련 노트 링크 추가
4. 관련 노트에 역방향 링크 추가 (양방향)
5. 연결 결과 보고

---

## 실행 조건

| 조건 | 설명 |
|------|------|
| **자동 실행** | Phase 5 노트 생성 완료 후 |
| **연결 수준** | 사용자 설정이 "보통" 또는 "최대"일 때 |
| **수동 실행** | "연결 강화해줘" 키워드 감지 시 |

---

## Phase 1: 새 노트 분석

### 1.1 핵심 개념 추출

새로 생성된 노트에서 다음을 추출:

```
추출 항목:
- 제목 키워드 (명사, 고유명사)
- 태그 (YAML frontmatter)
- 카테고리 (폴더 경로에서)
- 본문 핵심 개념 (## 섹션 제목들)
- 기존 wikilinks (이미 연결된 노트들)
```

### 1.2 키워드 추출 규칙

```
1. 제목 분석
   - 하이픈(-)으로 분리
   - 날짜 패턴 제외 (YYYY-MM-DD, YYYYMMDDHHmm)
   - 2글자 이상 단어만

2. 태그 분석
   - YAML frontmatter의 tags 필드
   - 슬래시(/) 기준 마지막 부분 추출

3. 본문 분석
   - ## 헤딩 텍스트
   - **강조** 텍스트
   - 첫 문단 핵심 명사
```

### 1.3 검색 쿼리 생성

```
예시:
노트 제목: "LLM 세션 종속성과 초기 프롬프트의 중요성 - 2026-01-03"

추출된 키워드:
- 제목: ["LLM", "세션", "종속성", "프롬프트"]
- 태그: ["AI-성능최적화", "프롬프트엔지니어링"]
- 본문: ["앵커링", "베이시스", "컨텍스트"]

생성된 쿼리:
- "LLM 세션"
- "프롬프트"
- "앵커링"
- "컨텍스트 엔지니어링"
```

---

## Phase 2: 관련 노트 탐색

### 2.1 Vault 검색

```
도구: mcp__obsidian__search_vault

검색 전략:
1. 키워드별 검색 실행
2. 결과 병합 및 중복 제거
3. 이미 연결된 노트 제외
4. 관련성 점수 계산
```

### 2.2 관련성 점수 계산

```
점수 계산 기준:
+3점: 제목 키워드 일치
+2점: 태그 일치
+2점: 동일 폴더
+1점: 본문 키워드 일치
+1점: 시간적 근접성 (30일 이내)

임계값: 3점 이상인 노트만 연결 후보
```

### 2.3 점수 계산 예시

```
새 노트: "LLM 세션 종속성과 초기 프롬프트의 중요성"
태그: [AI-성능최적화]
폴더: Zettelkasten/AI-성능최적화/

후보 노트 1: "AI 퍼포먼스 결정 요인의 4가지 차원"
- 제목 키워드 "AI", "퍼포먼스" → 부분 일치 +1
- 태그 AI-성능최적화 → +2
- 동일 폴더 → +2
- 총점: 5점 ✅ 연결

후보 노트 2: "MCP 프로토콜 상세 분석"
- 제목 키워드 불일치 → 0
- 태그 불일치 → 0
- 다른 폴더 → 0
- 총점: 0점 ❌ 제외
```

### 2.4 연결 후보 필터링

```
필터링 규칙:
- 최대 연결 수: 5개 (설정 가능)
- 제외 대상:
  - 이미 연결된 노트
  - 템플릿 파일 (_template.md)
  - 빈 노트 (0 bytes)
  - MOC 노트 (별도 처리)
```

---

## Phase 3: 양방향 링크 생성

### 3.1 새 노트에 링크 추가

```markdown
## 관련 노트

추가 위치: 본문 끝 (## 출처 이전)
없으면 새 섹션 생성

형식:
## 관련 노트

- [[관련노트1]] - 관련성: 태그 일치
- [[관련노트2]] - 관련성: 동일 폴더
- [[관련노트3]] - 관련성: 키워드 일치
```

### 3.2 기존 노트에 역방향 링크 추가

**CRITICAL**: 각 관련 노트에도 새 노트 링크 추가

```
도구: mcp__obsidian__update_note

업데이트 전략:
1. 기존 노트 읽기 (read_note)
2. "## 관련 노트" 섹션 찾기
3. 섹션 있으면 끝에 추가
4. 없으면 새 섹션 생성 (본문 끝)

형식:
- [[새노트]] - 자동 연결 (YYYY-MM-DD)
```

### 3.3 update_note 사용 예시

```
mcp__obsidian__update_note

path: "Zettelkasten/AI-성능최적화/AI 퍼포먼스 결정 요인의 4가지 차원 - 2025-10-05-0000.md"

edits:
  - mode: "insert"
    heading: "관련 노트"
    position: "append"
    content: "- [[LLM 세션 종속성과 초기 프롬프트의 중요성 - 2026-01-03]] - 자동 연결"

OR (섹션이 없을 경우):
  - oldText: "\n---\n\n**Tags**:"
    newText: "\n## 관련 노트\n\n- [[LLM 세션 종속성과 초기 프롬프트의 중요성 - 2026-01-03]] - 자동 연결\n\n---\n\n**Tags**:"
```

### 3.4 중복 방지

```
업데이트 전 확인:
1. 기존 노트 내용 읽기
2. 새 노트 링크가 이미 존재하는지 검사
3. 존재하면 스킵, 없으면 추가

정규식 확인:
/\[\[새노트제목.*?\]\]/
```

---

## Phase 4: 결과 보고

### 보고 형식

```markdown
## 연결 강화 결과

### 새 노트
- 노트: [[LLM 세션 종속성과 초기 프롬프트의 중요성 - 2026-01-03]]
- 생성 위치: Zettelkasten/AI-성능최적화/

### 추가된 연결 (양방향)

| 관련 노트 | 점수 | 연결 이유 |
|-----------|------|----------|
| [[AI 퍼포먼스 결정 요인의 4가지 차원]] | 5점 | 태그 + 폴더 |
| [[프롬프트 엔지니어링의 지속적 중요성]] | 4점 | 태그 + 키워드 |
| [[메모리 기능이 성능에 미치는 누적 효과]] | 3점 | 폴더 + 키워드 |

### 역방향 링크 추가 완료

| 기존 노트 | 상태 |
|-----------|------|
| [[AI 퍼포먼스 결정 요인의 4가지 차원]] | ✅ 추가됨 |
| [[프롬프트 엔지니어링의 지속적 중요성]] | ✅ 추가됨 |
| [[메모리 기능이 성능에 미치는 누적 효과]] | ✅ 추가됨 |

### 통계
- 검색된 관련 노트: 12개
- 연결된 노트: 3개 (양방향 6개 링크)
- 이미 연결됨 (스킵): 2개
```

---

## 설정 옵션

| 옵션 | 기본값 | 설명 |
|------|--------|------|
| `max_links` | 5 | 최대 연결 노트 수 |
| `min_score` | 3 | 최소 관련성 점수 |
| `add_backlinks` | true | 양방향 링크 생성 여부 |
| `exclude_folders` | ["templates", "assets", "Bug_Reports"] | 검색 제외 폴더 |
| `auto_run` | true | 노트 생성 후 자동 실행 |
| `include_moc` | false | MOC 노트에도 연결 추가 |

---

## 수동 실행

노트 생성 없이 기존 노트 연결 강화 시:

```
사용자: "이 노트 연결 강화해줘: [[노트이름]]"
또는: "[[노트이름]] 관련 노트 찾아줘"

→ Phase 1부터 시작하여 해당 노트의 연결 강화
```

### 배치 모드

```
사용자: "Zettelkasten 폴더 전체 연결 강화해줘"

→ 폴더 내 모든 노트에 대해 연결 강화 실행
→ 진행률 보고
→ 최종 통계 제공
```

---

## 에러 처리

| 에러 유형 | 대응 |
|----------|------|
| 검색 결과 없음 | 쿼리 확장 시도 → "고유한 주제" 보고 |
| 노트 업데이트 실패 | 재시도 → 수동 추가 안내 |
| 관련 노트 0개 | "독립적 주제로 판단됨" 보고 |
| 중복 링크 감지 | 스킵 후 보고 |

---

## 통합: km-workflow.md Phase 5.5

이 스킬은 `km-workflow.md`의 Phase 5.5에서 자동 호출됩니다.

```
Phase 5: 내보내기 실행 (노트 생성)
    ↓
Phase 5.5: 연결 강화 (이 스킬)
    ↓
Phase 6: 검증 및 보고
```

---

## 참고: Obsidian MCP 도구

이 스킬에서 사용하는 MCP 도구:

| 도구 | 용도 |
|------|------|
| `mcp__obsidian__search_vault` | 관련 노트 검색 |
| `mcp__obsidian__read_note` | 기존 노트 내용 확인 |
| `mcp__obsidian__update_note` | 역방향 링크 추가 |
| `mcp__obsidian__auto_backlink_vault` | 일괄 백링크 생성 (배치 모드) |
